<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
  <title>Quiz Engine</title>
  <link rel="stylesheet" href="/css/style.css" />
  <!-- Prevent browser zoom (Ctrl+scroll, Ctrl+Â±, pinch) -->
  <script>
    document.addEventListener('wheel', function(e){ if(e.ctrlKey){ e.preventDefault(); } }, { passive: false });
    document.addEventListener('keydown', function(e){ if(e.ctrlKey && (e.key==='+' || e.key==='-' || e.key==='=' || e.key==='0')){ e.preventDefault(); } });
  </script>
</head>
<body>

  <!-- Global mute toggle (always visible) -->
  <button class="btn-mute" id="btn-mute" title="Toggle sound">ğŸ”Š</button>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Home â€” Choose Host or Player
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-home" class="view active">
    <img class="home-hero-logo" src="/images/TooryanLogo.png" alt="Tooryan Studios" />
    <div class="card center-card">
      <h1 class="logo">âš¡ QuizEngine</h1>
      <p class="subtitle">Real-time multiplayer quiz</p>
      <p id="quiz-title-banner" style="display:none; font-size:1.1rem; font-weight:600; color:#60a5fa; margin:0.25rem 0 0.75rem; text-align:center;"></p>
      <div class="btn-group vertical">
        <button class="btn btn-primary" id="btn-become-host">
          ğŸ™ï¸ I'm a Host
        </button>
        <button class="btn btn-secondary" id="btn-become-player">
          ğŸ™‹ I'm a Player
        </button>
      </div>      <p class="build-time" id="build-time">Loading versionâ€¦</p>    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Player â€” Join Room Form
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-player-join" class="view">
    <div class="card center-card">
      <button class="btn-back" id="btn-back-from-join">â† Back</button>
      <h2>Join a Game</h2>
      <p id="join-quiz-title-banner" style="display:none; font-size:1rem; font-weight:600; color:#60a5fa; margin:0 0 0.75rem; text-align:center;"></p>
      <div id="scan-fallback-banner" class="scan-fallback" style="display:none">
        <strong>Having trouble after scanning?</strong>
        <span>Use the Room PIN shown on the host screen and join manually.</span>
      </div>
      <form id="form-join">
        <div class="field">
          <label for="input-pin">Room PIN</label>
          <input
            id="input-pin"
            type="text"
            inputmode="numeric"
            pattern="[0-9]*"
            maxlength="6"
            placeholder="e.g. 482910"
            autocomplete="off"
            required
          />
        </div>
        <div class="field">
          <label for="input-nickname">Your Nickname</label>
          <input
            id="input-nickname"
            type="text"
            maxlength="20"
            placeholder="e.g. SuperQuizzer"
            autocomplete="off"
            required
          />
        </div>
        <div class="field">
          <label>Avatar</label>
          <button type="button" id="join-avatar-btn" class="avatar-trigger-btn">
            <span class="avatar-trigger-icon" id="join-avatar-display">ğŸ®</span>
            <span class="avatar-trigger-label">Choose Avatar</span>
            <span class="avatar-trigger-arrow">â€º</span>
          </button>
        </div>
        <p class="error-msg" id="join-error"></p>
        <button type="submit" class="btn btn-primary full-width">Join Game</button>
      </form>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Host â€” Lobby (waiting for players)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-host-lobby" class="view">
    <div class="card lobby-card">
      <img class="studio-logo" src="/images/TooryanLogo.png" alt="Tooryan Studios logo" />
      <button class="btn-back" id="btn-back-from-host-lobby">â† Back</button>

      <!-- Connection Mode Toggle -->
      <div class="mode-toggle">
        <div class="mode-header">
          <span class="mode-indicator" id="mode-indicator">ğŸŒ Global</span>
          <span class="mode-warning" id="mode-warning" style="display:none"></span>
        </div>
        <div class="mode-buttons">
          <button class="btn btn-mode" id="btn-mode-local">ğŸ“¶ Local LAN</button>
          <button class="btn btn-mode" id="btn-mode-global">ğŸŒ Global Web</button>
        </div>
        <p class="mode-url" id="host-join-url">â€”</p>
        <button class="btn btn-secondary full-width" id="btn-copy-join-url">ğŸ“‹ Copy Join URL</button>
      </div>

      <div class="pin-display">
        <span class="pin-label">Room PIN</span>
        <span class="pin-code" id="host-pin">------</span>
        <span class="pin-hint">Share this PIN with players</span>
        <span class="difficulty-label" id="host-lobby-difficulty">ğŸŸ¡ Difficulty: Classic</span>
      </div>
      <!-- QR Code for players to scan -->
      <div class="qr-section">
        <p class="qr-label">ğŸ“· Scan to join instantly</p>
        <div class="qr-wrapper">
          <div id="host-qr-canvas"></div>
        </div>
      </div>

      <div class="player-list-section">
        <h3>Players (<span id="host-player-count">0</span>)</h3>
        <ul class="player-list" id="host-player-list"></ul>
        <p class="hint-text" id="kick-hint" style="display:none">Tap a player to kick them</p>
      </div>
      <button class="btn btn-success full-width" id="btn-start-game" disabled>
        Start Game
      </button>
      <p class="hint-text" id="lobby-hint">Waiting for at least 1 playerâ€¦</p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Player â€” Lobby (waiting for host)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-player-lobby" class="view">
    <div class="card lobby-card">
      <img class="studio-logo" src="/images/TooryanLogo.png" alt="Tooryan Studios logo" />
      <div class="pin-display">
        <span class="pin-label">Room PIN</span>
        <span class="pin-code" id="player-room-pin">------</span>
        <span class="difficulty-label" id="player-lobby-difficulty">ğŸŸ¡ Difficulty: Classic</span>
      </div>
      <p class="waiting-text">
        Waiting for the host to startâ€¦
      </p>
      <!-- Edit profile before game starts -->
      <div style="display:flex;flex-direction:column;gap:8px;width:100%;">
        <button class="edit-profile-toggle" id="btn-edit-profile">âœï¸ Edit Name &amp; Avatar</button>
        <div class="edit-profile-panel" id="edit-profile-panel">
          <div class="field" style="gap:6px;">
            <label>Nickname</label>
            <div class="edit-profile-row">
              <input id="edit-nickname-input" class="edit-profile-input" maxlength="20" placeholder="New nickname" autocomplete="off" />
              <button type="button" class="btn btn-primary" id="btn-save-profile" style="padding:10px 18px;white-space:nowrap">Save</button>
            </div>
            <p class="error-msg" id="edit-profile-error"></p>
          </div>
          <div class="field" style="gap:6px;">
            <label>Avatar</label>
            <button type="button" id="lobby-avatar-btn" class="avatar-trigger-btn">
              <span class="avatar-trigger-icon" id="lobby-avatar-display">ğŸ®</span>
              <span class="avatar-trigger-label">Change Avatar</span>
              <span class="avatar-trigger-arrow">â€º</span>
            </button>
          </div>
        </div>
      </div>
      <div class="player-list-section">
        <h3>Players in room (<span id="player-player-count">0</span>)</h3>
        <ul class="player-list" id="player-player-list"></ul>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Question â€” Host sees question + live counter
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-host-question" class="view">
    <div class="question-layout" id="host-question-layout">
      <div class="question-header">
        <span class="q-progress" id="host-q-progress">Q 1 / 8</span>
        <span class="difficulty-tag" id="host-q-difficulty">Classic</span>
        <div class="timer-ring" id="host-timer-ring">
          <span class="timer-count" id="host-timer-count">30</span>
        </div>
        <span class="answer-counter" id="host-answer-counter">0 / 0 answered</span>
      </div>
      <!-- Host controls -->
      <div class="host-controls">
        <button class="btn btn-host-ctrl" id="btn-pause-resume">â¸ï¸ Pause</button>
        <button class="btn btn-host-ctrl btn-skip" id="btn-skip">â© Skip</button>
        <button class="btn btn-host-ctrl btn-end" id="btn-end-game">ğŸ›‘ End Game</button>
      </div>
      <div class="question-text-box">
        <p class="question-text" id="host-question-text">Loading questionâ€¦</p>
      </div>
      <div id="host-boss-panel" class="boss-panel" style="display:none">
        <div class="boss-row">
          <span class="boss-name" id="host-boss-name">Tooryan Boss</span>
          <span class="boss-hp" id="host-boss-hp">100 / 100</span>
        </div>
        <div class="boss-bar"><div class="boss-bar-fill" id="host-boss-bar-fill"></div></div>
      </div>
      <div class="options-grid" id="host-options-grid">
        <!-- 4 option cards injected by game.js -->
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Question â€” Player sees question + answer buttons
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-player-question" class="view">
    <div class="question-layout" id="player-question-layout">
      <div class="question-header">
        <span class="q-progress" id="player-q-progress">Q 1 / 8</span>
        <span class="difficulty-tag" id="player-q-difficulty">Classic</span>
        <div class="timer-ring" id="player-timer-ring">
          <span class="timer-count" id="player-timer-count">30</span>
        </div>
        <span class="score-badge" id="player-score-badge">ğŸ’ <span id="player-score-count">0</span> pts</span>
        <span class="streak-badge" id="player-streak-badge" style="display:none">ğŸ”¥ <span id="player-streak-count">0</span></span>
        <span class="role-badge" id="player-role-badge" style="display:none">Role: â€”</span>
      </div>
      <div class="question-text-box">
        <p class="question-text" id="player-question-text">Loading questionâ€¦</p>
      </div>
      <div class="options-grid" id="player-options-grid">
        <!-- single / multi buttons injected by game.js -->
      </div>

      <div id="player-type-container" class="type-container" style="display:none">
        <input id="player-type-input" type="text" autocomplete="off" placeholder="Type your answer" />
      </div>

      <div id="player-boss-panel" class="boss-panel" style="display:none">
        <div class="boss-row">
          <span class="boss-name" id="player-boss-name">Tooryan Boss</span>
          <span class="boss-hp" id="player-boss-hp">100 / 100</span>
        </div>
        <div class="boss-bar"><div class="boss-bar-fill" id="player-boss-bar-fill"></div></div>
      </div>

      <!-- â”€â”€ Match: drag-and-drop layout (built by JS) â”€â”€ -->
      <div id="player-match-container" class="match-container" style="display:none"></div>

      <!-- â”€â”€ Order: drag-to-sort list â”€â”€ -->
      <div id="player-order-container" class="order-container" style="display:none">
        <ol class="order-list" id="order-list"></ol>
      </div>

      <!-- Submit button for multi / match / order (hidden for single) -->
      <button id="btn-submit-answer" class="btn btn-success full-width" style="display:none">
        âœ” ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
      </button>

      <div id="player-role-panel" class="role-panel" style="display:none">
        <p id="player-role-panel-title">Role ability</p>
        <div class="role-controls">
          <select id="role-target-select"></select>
          <button id="btn-role-action" class="btn btn-secondary" type="button">Use ability</button>
        </div>
        <p id="player-role-hint" class="hint-text"></p>
      </div>

      <p class="answered-msg" id="player-answered-msg"></p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       OVERLAY: Game Paused
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="overlay-paused" class="pause-overlay" style="display:none">
    <div class="pause-card">
      <p class="pause-icon">â¸ï¸</p>
      <h2>Game Paused</h2>
      <p class="pause-sub">Waiting for the host to resumeâ€¦</p>
      <button class="btn btn-primary" id="btn-overlay-resume" style="display:none">
        â–¶ï¸ Resume Game
      </button>
    </div>
  </div>

  <div id="overlay-frozen" class="pause-overlay" style="display:none">
    <div class="pause-card">
      <p class="pause-icon">â„ï¸</p>
      <h2>Screen Frozen</h2>
      <p class="pause-sub" id="frozen-msg">Saboteur used freeze ability</p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Question Result (correct answer reveal)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-question-result" class="view">
    <div class="card center-card result-card">
      <h2 id="result-correct-label">âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</h2>
      <p class="result-answer" id="result-correct-answer">â€”</p>
      <!-- For match / order types: correct pairs / sorted items -->
      <ul class="result-pairs-list" id="result-pairs-list" style="display:none"></ul>
      <p id="result-player-score-msg" class="result-score-msg"></p>
      <p id="result-streak-msg" class="result-streak-msg"></p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Leaderboard (between questions)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-leaderboard" class="view">
    <div class="card leaderboard-card">
      <h2 class="lb-title" id="lb-title">ğŸ† Leaderboard</h2>
      <ol class="leaderboard-list" id="leaderboard-list"></ol>
      <p class="lb-next-hint" id="lb-next-hint">Next question coming upâ€¦</p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Game Over â€” Podium Ceremony
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-game-over" class="view">
    <div class="podium-ceremony">

      <h2 class="podium-title" id="podium-title">ğŸ‰ Final Results</h2>

      <!-- â”€â”€ Podium Stage â”€â”€ -->
      <div class="podium-stage" id="podium-stage">

        <!-- 2nd place â€” left -->
        <div class="podium-col podium-2nd" id="podium-slot-2">
          <div class="podium-avatar-wrap">
            <div class="podium-avatar" id="podium-avatar-2">ğŸ®</div>
            <div class="podium-nickname" id="podium-name-2">â€”</div>
            <div class="podium-score" id="podium-score-2">0 pts</div>
          </div>
          <div class="podium-block podium-block-2">
            <span class="podium-medal">ğŸ¥ˆ</span>
            <span class="podium-rank-num">2</span>
          </div>
        </div>

        <!-- 1st place â€” center (tallest) -->
        <div class="podium-col podium-1st" id="podium-slot-1">
          <div class="podium-avatar-wrap">
            <div class="podium-trophy-crown">ğŸ†</div>
            <div class="podium-avatar podium-avatar-gold" id="podium-avatar-1">ğŸ®</div>
            <div class="podium-nickname podium-nickname-gold" id="podium-name-1">â€”</div>
            <div class="podium-score podium-score-gold" id="podium-score-1">0 pts</div>
          </div>
          <div class="podium-block podium-block-1">
            <span class="podium-medal">ğŸ¥‡</span>
            <span class="podium-rank-num">1</span>
          </div>
        </div>

        <!-- 3rd place â€” right -->
        <div class="podium-col podium-3rd" id="podium-slot-3">
          <div class="podium-avatar-wrap">
            <div class="podium-avatar" id="podium-avatar-3">ğŸ®</div>
            <div class="podium-nickname" id="podium-name-3">â€”</div>
            <div class="podium-score" id="podium-score-3">0 pts</div>
          </div>
          <div class="podium-block podium-block-3">
            <span class="podium-medal">ğŸ¥‰</span>
            <span class="podium-rank-num">3</span>
          </div>
        </div>

      </div><!-- /podium-stage -->

      <!-- â”€â”€ Full leaderboard (fades in after podium ceremony) â”€â”€ -->
      <div class="podium-full-results" id="podium-full-results">
        <div id="winner-announcement" class="winner-announcement" style="display:none">
          <p class="winner-label">ğŸ† Winner</p>
          <p class="winner-name" id="winner-name">â€”</p>
          <p class="winner-score" id="winner-score">0 pts</p>
        </div>
        <details class="podium-details" id="podium-details">
          <summary class="podium-details-summary">ğŸ“‹ Full Leaderboard</summary>
          <ol class="leaderboard-list" id="final-leaderboard-list"></ol>
        </details>
        <div class="podium-actions">
          <button class="btn btn-success full-width" id="btn-start-new-session" style="display:none">
            ğŸ”„ Start New Session
          </button>
          <button class="btn btn-primary full-width" id="btn-play-again">
            ğŸ” Play Again
          </button>
        </div>
      </div>

    </div><!-- /podium-ceremony -->
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEW: Room Closed (host disconnected)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-room-closed" class="view">
    <div class="card center-card">
      <h2>ğŸšª Room Closed</h2>
      <p id="room-closed-msg">The host has left the game.</p>
      <button class="btn btn-primary full-width" id="btn-home-from-closed">
        Back to Home
      </button>
    </div>
  </div>

  <!-- Avatar Picker Modal (shared) -->
  <div id="avatar-picker-modal" class="avatar-picker-modal" style="display:none" role="dialog" aria-modal="true" aria-label="Choose your avatar">
    <div class="avatar-picker-dialog">
      <div class="avatar-picker-header">
        <span>Choose Your Avatar</span>
        <button type="button" id="btn-close-avatar-picker" class="avatar-picker-close">&times;</button>
      </div>
      <div class="avatar-grid" id="modal-avatar-grid"></div>
    </div>
  </div>

  <div class="tooryan-attribution" aria-label="Prototype attribution">
    <span>Â© Tooryan Studios â€” Prototype build</span>
  </div>

  <!-- â”€â”€â”€ Scripts â”€â”€â”€ -->
  <!-- Confetti for game over celebration -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <!-- Load Socket.io client from the server (auto-served by socket.io) -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/game.js"></script>
</body>
</html>
